<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pila</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <a href="Proyecto.html">Inicio</a> |
        <a href="Pila.html">Pila</a> |
        <a href="Cola.html">Cola</a> |
        <a href="Lista.html">Lista Enlazada</a>
    </nav>
    <hr>
    <h1>Pila</h1>
    
    <div class="control-section">
        <input type="text" id="inputPila" placeholder="Ingrese un número" class="form-control d-inline-block">
        <button onclick="app.push()" class="btn btn-primary">Push</button>
        <button onclick="app.pop()" class="btn btn-danger">Pop</button>
        <p id="mensaje"></p>
        <div class="storage-buttons">
            <button onclick="app.crearNueva()" class="btn btn-success">Crear Nueva</button>
            <button onclick="app.descargarTxt()" class="btn btn-info">Descargar TXT</button>
            <button onclick="document.getElementById('filePila').click()" class="btn btn-info">Cargar TXT</button>
            <input type="file" id="filePila" accept=".txt" class="hidden-file" onchange="app.cargarTxt(event)">
        </div>
    </div>

    <div class="content-container">
        <div class="visualization-container">
            <h3>Visualización:</h3>
            <div id="lienzo" data-structure="pila">La pila está vacía</div>
        </div>

        <div class="code-container">
            <h3>Código C:</h3>
            <pre id="codigoDisplay">Seleccione una operación...</pre>
        </div>
    </div>

    <script>
        const CODIGO_C = {
            push: `typedef struct Nodo {
    int dato;
    struct Nodo* siguiente;
} Nodo;

void push(Nodo** tope, int dato) {
    Nodo* nuevoNodo = (Nodo*)malloc(sizeof(Nodo));
    nuevoNodo->dato = dato;
    nuevoNodo->siguiente = *tope;
    *tope = nuevoNodo;
    printf("Elemento %d apilado\\n", dato);
}`,
            pop: `int pop(Nodo** tope) {
    if (*tope == NULL) return -1;
    Nodo* temporal = *tope;
    int dato = temporal->dato;
    *tope = (*tope)->siguiente;
    free(temporal);
    return dato;
}`
        };

        const app = {
            datos: [],

            /*Crear nueva pila*/
            crearNueva() {
                this.datos = [];
                this.render();
                this.mensaje('Pila nueva creada');
                document.getElementById('inputPila').value = '';
                document.getElementById('codigoDisplay').innerHTML = 'Seleccione una operación...';
            },

            /*Descargar pila como archivo txt*/
            descargarTxt() {
                if (this.datos.length === 0) return this.mensaje('Pila vacía, nada que descargar');
                const contenido = this.datos.join(',');
                const blob = new Blob([contenido], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'pila.txt';
                a.click();
                window.URL.revokeObjectURL(url);
                this.mensaje('Pila descargada');
            },

            /*Cargar pila desde archivo txt*/
            cargarTxt(event) {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const contenido = e.target.result.trim();
                    if (!contenido) return this.mensaje('Archivo vacío');
                    this.datos = contenido.split(',').map(d => d.trim()).filter(d => !isNaN(d) && d !== '');
                    if (this.datos.length === 0) return this.mensaje('Archivo sin datos válidos');
                    this.render();
                    this.mensaje(`Cargados ${this.datos.length} elementos`);
                };
                reader.readAsText(file);
                event.target.value = '';
            },

            /**
             * Función Push: Agrega un elemento al tope de la pila.
             * Valida el input, lo añade al arreglo, y llama a renderizar.
             */
            push() {
                const input = document.getElementById('inputPila');
                const val = input.value.trim();
                if (!val || isNaN(val)) return alert("Ingrese un número");
                
                this.datos.push(val);
                this.render();
                this.mostrarCodigo(CODIGO_C.push);
                this.mensaje(`Push: ${val}`);
                input.value = '';
                input.focus();
            },

            /**
             * Función Pop: Elimina el elemento del tope.
             * Utiliza el método pop() nativo de arrays que saca el último elemento insertado (LIFO).
             */
            pop() {
                if (this.datos.length === 0) return this.mensaje('Pila vacía');
                const val = this.datos.pop();
                this.render();
                this.mostrarCodigo(CODIGO_C.pop);
                this.mensaje(`Pop: ${val}`);
            },

            /**
             * Renderiza la pila visualmente.
             * Invierte una copia del arreglo (.slice().reverse()) para que
             * el último elemento agregado aparezca visualmente arriba en la columna.
             */
            render() {
                const div = document.getElementById('lienzo');
                div.innerHTML = '';
                if (this.datos.length === 0) {
                    div.innerHTML = 'Vacía';
                    return;
                }
                // Renderizar invertido para que el tope quede arriba visualmente
                this.datos.slice().reverse().forEach(d => {
                    const nodo = document.createElement('div');
                    nodo.style.border = "1px solid black";
                    nodo.style.width = "50px";
                    nodo.style.padding = "5px";
                    nodo.style.textAlign = "center";
                    nodo.className = 'nodo-entrada';
                    nodo.textContent = d;
                    div.appendChild(nodo);
                });
            },

            // Función auxiliar para mostrar el código C en pantalla
            mostrarCodigo(txt) {
                document.getElementById('codigoDisplay').innerHTML = txt.replace(/\n/g, '<br>').replace(/ /g, '&nbsp;');
            },
            
            // Función auxiliar para mostrar mensajes temporales
            mensaje(txt) {
                document.getElementById('mensaje').textContent = txt;
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>