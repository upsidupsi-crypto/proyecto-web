<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista Enlazada</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <a href="Proyecto.html">Inicio</a> |
        <a href="Pila.html">Pila</a> |
        <a href="Cola.html">Cola</a> |
        <a href="Lista.html">Lista Enlazada</a>
    </nav>
    <hr>
    <h1>Lista Enlazada</h1>
    
    <div id="initialModal" class="modal-overlay">
        <div class="modal-box">
            <h2>Lista Enlazada</h2>
            <p>¿Qué deseas hacer?</p>
            <div class="modal-buttons">
                <button onclick="app.crearNueva()" class="btn btn-primary">Crear Nueva</button>
                <button onclick="app.cargarGuardada()" class="btn btn-info">Cargar Guardada</button>
            </div>
        </div>
    </div>
    
    <div class="control-section">
        <div>
            <input type="text" id="inputLista" placeholder="Ingrese un número" class="form-control mb-3">
        </div>
        <div>
            <h4 class="section-title">Insertar:</h4>
            <button onclick="app.insertarInicio()" class="btn btn-success me-2">Insertar Inicio</button>
            <button onclick="app.insertarFinal()" class="btn btn-success me-2">Insertar Final</button>
            <button onclick="app.mostrarModalPosicion('insertar')" class="btn btn-success">Insertar en Posición</button>
        </div>
        <div>
            <h4 class="section-title">Eliminar:</h4>
            <button onclick="app.eliminarInicio()" class="btn btn-danger me-2">Eliminar Inicio</button>
            <button onclick="app.eliminarFinal()" class="btn btn-danger me-2">Eliminar Final</button>
            <button onclick="app.eliminar()" class="btn btn-danger me-2">Eliminar por Valor</button>
            <button onclick="app.mostrarModalPosicion('eliminar')" class="btn btn-danger">Eliminar por Posición</button>
        </div>
        <p id="mensaje"></p>
        <div class="storage-buttons">
            <button onclick="app.descargarTxt()" class="btn btn-info">Descargar TXT</button>
            <button onclick="document.getElementById('fileLista').click()" class="btn btn-info">Cargar TXT</button>
            <input type="file" id="fileLista" accept=".txt" class="hidden-file" onchange="app.cargarTxt(event)">
        </div>
    </div>

    <div id="posicionModal" class="modal-overlay">
        <div class="modal-box">
            <h2 id="modalTitulo">Insertar en Posición</h2>
            <p>Ingrese la posición (0-indexado)</p>
            <div class="input-group">
                <input type="number" id="inputPosicion" placeholder="Posición" min="0" value="0" class="form-control">
                <button onclick="app.confirmarPosicion()" class="btn btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <div class="content-container">
        <div class="visualization-container">
            <h3>Visualización:</h3>
            <div id="lienzo" data-structure="lista">La lista está vacía</div>
        </div>

        <div class="code-container">
            <h3>Código C:</h3>
            <pre id="codigoDisplay">Seleccione una operación...</pre>
        </div>
    </div>

    <script>
        const CODIGO_C = {
            inicio: `void insertarInicio(Nodo** cabeza, int dato) {
    Nodo* nuevoNodo = (Nodo*)malloc(sizeof(Nodo));
    nuevoNodo->dato = dato;
    nuevoNodo->siguiente = *cabeza;
    *cabeza = nuevoNodo;
}`,
            final: `void insertarFinal(Nodo** cabeza, int dato) {
    Nodo* nuevoNodo = (Nodo*)malloc(sizeof(Nodo));
    nuevoNodo->dato = dato;
    nuevoNodo->siguiente = NULL;
    if (*cabeza == NULL) {
        *cabeza = nuevoNodo;
        return;
    }
    Nodo* actual = *cabeza;
    while (actual->siguiente != NULL) actual = actual->siguiente;
    actual->siguiente = nuevoNodo;
}`,
            eliminar: `void eliminar(Nodo** cabeza, int valor) {
    Nodo* actual = *cabeza;
    Nodo* anterior = NULL;
    while (actual != NULL && actual->dato != valor) {
        anterior = actual;
        actual = actual->siguiente;
    }
    if (actual == NULL) return;
    if (anterior == NULL) *cabeza = actual->siguiente;
    else anterior->siguiente = actual->siguiente;
    free(actual);
}`
        };

        const app = {
            datos: [],
            operacionPosicion: null,
            
            /*Descargar lista como archivo txt*/
            descargarTxt() {
                if (this.datos.length === 0) return this.mensaje('Lista vacía, nada que descargar');
                const contenido = this.datos.join(',');
                const blob = new Blob([contenido], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'lista.txt';
                a.click();
                window.URL.revokeObjectURL(url);
                this.mensaje('Lista descargada');
            },

            /*Cargar lista desde archivo txt*/
            cargarTxt(event) {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const contenido = e.target.result.trim();
                    if (!contenido) return this.mensaje('Archivo vacío');
                    this.datos = contenido.split(',').map(d => d.trim()).filter(d => !isNaN(d) && d !== '');
                    if (this.datos.length === 0) return this.mensaje('Archivo sin datos válidos');
                    this.render();
                    this.mensaje(`Cargados ${this.datos.length} elementos`);
                };
                reader.readAsText(file);
                event.target.value = '';
            },

            /*Descargar lista como archivo txt*/
            descargarArchivo() {
                if (this.datos.length === 0) return this.mensaje('Lista vacía, nada que descargar');
                const contenido = this.datos.join(',');
                const blob = new Blob([contenido], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'lista.txt';
                a.click();
                window.URL.revokeObjectURL(url);
                this.mensaje('Lista descargada');
            },

            /*Cargar lista desde archivo txt*/
            cargarArchivo(event) {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const contenido = e.target.result.trim();
                    if (!contenido) return this.mensaje('Archivo vacío');
                    this.datos = contenido.split(',').map(d => d.trim()).filter(d => !isNaN(d) && d !== '');
                    if (this.datos.length === 0) return this.mensaje('Archivo sin datos válidos');
                    this.render();
                    this.mensaje(`Cargados ${this.datos.length} elementos`);
                };
                reader.readAsText(file);
                event.target.value = '';
            },

            /*Mostrar modal de posición*/
            mostrarModalPosicion(operacion) {
                this.operacionPosicion = operacion;
                const modal = document.getElementById('posicionModal');
                const titulo = document.getElementById('modalTitulo');
                titulo.textContent = operacion === 'insertar' ? 'Insertar en Posición' : 'Eliminar por Posición';
                modal.classList.add('active');
                document.getElementById('inputPosicion').focus();
            },

            /*Confirmar operación de posición*/
            confirmarPosicion() {
                const posicion = parseInt(document.getElementById('inputPosicion').value);
                document.getElementById('posicionModal').classList.remove('active');
                
                if (this.operacionPosicion === 'insertar') {
                    const val = this.getVal();
                    if (val === null) return;
                    if (posicion < 0 || posicion > this.datos.length) {
                        return this.mensaje('Posición inválida');
                    }
                    this.datos.splice(posicion, 0, val);
                    this.render();
                    this.mostrarCodigo(CODIGO_C.inicio);
                    this.mensaje(`Insertado en posición ${posicion}: ${val}`);
                } else if (this.operacionPosicion === 'eliminar') {
                    if (posicion < 0 || posicion >= this.datos.length) {
                        return this.mensaje('Posición inválida');
                    }
                    const val = this.datos[posicion];
                    this.datos.splice(posicion, 1);
                    this.render();
                    this.mostrarCodigo(CODIGO_C.eliminar);
                    this.mensaje(`Eliminado de posición ${posicion}: ${val}`);
                }
            },
            
            /**
             * Inserta un nodo al principio de la lista.
             * Utiliza unshift para colocar el elemento en el índice 0 del arreglo.
             */
            insertarInicio() {
                const val = this.getVal();
                if (val === null) return;
                this.datos.unshift(val);
                this.render();
                this.mostrarCodigo(CODIGO_C.inicio);
                this.mensaje(`Insertado inicio: ${val}`);
            },

            /**
             * Inserta un nodo al final de la lista.
             * Utiliza push para colocar el elemento en el último índice.
             */
            insertarFinal() {
                const val = this.getVal();
                if (val === null) return;
                this.datos.push(val);
                this.render();
                this.mostrarCodigo(CODIGO_C.final);
                this.mensaje(`Insertado final: ${val}`);
            },

            /*Elimina el primer elemento*/
            eliminarInicio() {
                if (this.datos.length === 0) return this.mensaje('Lista vacía');
                const val = this.datos.shift();
                this.render();
                this.mostrarCodigo(CODIGO_C.eliminar);
                this.mensaje(`Eliminado del inicio: ${val}`);
            },

            /*Elimina el último elemento*/
            eliminarFinal() {
                if (this.datos.length === 0) return this.mensaje('Lista vacía');
                const val = this.datos.pop();
                this.render();
                this.mostrarCodigo(CODIGO_C.eliminar);
                this.mensaje(`Eliminado del final: ${val}`);
            },

            /**
             * Busca y elimina un nodo basado en su valor.
             * Busca el índice del valor y si existe lo elimina usando splice.
             */
            eliminar() {
                const val = this.getVal();
                if (val === null) return;
                const idx = this.datos.indexOf(String(val));
                if (idx === -1) return this.mensaje('Valor no encontrado');
                this.datos.splice(idx, 1);
                this.render();
                this.mostrarCodigo(CODIGO_C.eliminar);
                this.mensaje(`Eliminado: ${val}`);
            },

            /**
             * Dibuja la lista enlazada en el DOM.
             * Crea divs para los nodos y flechas (->) entre ellos.
             */
            render() {
                const div = document.getElementById('lienzo');
                div.innerHTML = '';
                if (this.datos.length === 0) {
                    div.innerHTML = 'NULL';
                    return;
                }
                this.datos.forEach(d => {
                    const caja = document.createElement('div');
                    caja.style.border = "1px solid black";
                    caja.style.padding = "5px";
                    caja.className = 'nodo-entrada';
                    caja.textContent = d;
                    div.appendChild(caja);
                    
                    const flecha = document.createElement('span');
                    flecha.innerHTML = "&nbsp;&rarr;&nbsp;";
                    div.appendChild(flecha);
                });
                const fin = document.createElement('span');
                fin.textContent = "NULL";
                div.appendChild(fin);
            },

            /**
             * Función auxiliar para obtener y validar el valor del input.
             */
            getVal() {
                const input = document.getElementById('inputLista');
                const val = input.value.trim();
                if (!val || isNaN(val)) {
                    alert("Ingrese un número");
                    return null;
                }
                input.value = '';
                input.focus();
                return val;
            },

            // Función auxiliar para inyectar el código C en el HTML
            mostrarCodigo(txt) {
                document.getElementById('codigoDisplay').innerHTML = txt.replace(/\n/g, '<br>').replace(/ /g, '&nbsp;');
            },
            
            // Función auxiliar para mostrar notificaciones breves
            mensaje(txt) {
                document.getElementById('mensaje').textContent = txt;
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>